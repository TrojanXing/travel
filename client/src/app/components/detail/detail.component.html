<div class="container">

  <div class="h3 text-center mt-4">{{ detail?.name }}</div>

  <div class="title_container">
    <button class="btn btn-outline-secondary" (click)="hideDetail()"><i class="fas fa-angle-left"></i> List</button>
    <img class="float-right clickable" src="http://cs-server.usc.edu:45678/hw/hw8/images/Twitter.png" style="width: 40px; height: 40px;" (click)="composeTweet()">
    <button class="btn btn-outline-secondary float-right mr-2" style="width: 40px; height: 40px;" (click)="addOrRemoveFavorite()">
      <i *ngIf="!checkIfInFavorite()" class="far fa-star"></i>
      <i *ngIf="checkIfInFavorite()" class="fas fa-star" style="color: gold"></i>
    </button>
  </div>

  <!--Tab * 4-->
  <div class="tab_container mt-4">
    <ul class="nav nav-tabs row justify-content-end">
      <li class="nav-item">
        <a class="nav-link active" href="#info" data-toggle="tab">Info</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#photos" data-toggle="tab">Photos</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#map_container" data-toggle="tab">Map</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#reviews" data-toggle="tab">Reviews</a>
      </li>
    </ul>
  </div>

  <div class="tab-content mt-3">
    <!--Info-->
    <div class="tab-pane fade show active mt-3" id="info">
      <table class="table table-striped">
        <tbody>
          <tr *ngIf="detail && detail['formatted_address']"><th scope="row">Address</th><td>{{ (detail)?.formatted_address }}</td></tr>
          <tr *ngIf="detail && detail['international_phone_number']"><th scope="row">Phone Number</th><td>{{ (detail)?.international_phone_number }}</td></tr>
          <tr *ngIf="detail && detail['price_level']"><th scope="row">Price Level</th><td>{{ calcPriceLevel((detail)?.price_level) }}</td></tr>
          <tr *ngIf="detail && detail['rating']">
            <th scope="row">Rating</th>
            <td>{{ (detail)?.rating }}
              <div [ngStyle]="{'overflow': 'hidden', 'width.px': 18*(detail)?.rating, 'display': 'inline-block'}"><div style="overflow: hidden; width: 100px; height: 20px;"><i *ngFor="let n of createArr(5)" class="fas fa-star" style="color: gold"></i></div></div>
            </td>
          </tr>
          <tr *ngIf="detail && detail['url']"><th scope="row">Google Page</th><td><a href="{{ (detail)?.url }}" target="_blank">{{ (detail)?.url }}</a></td></tr>
          <tr *ngIf="detail && detail['website']"><th scope="row">Website</th><td><a href="{{ (detail)?.website }}" target="_blank">{{ (detail)?.website }}</a></td></tr>
          <tr *ngIf="detail && detail['opening_hours']"><th scope="row">Hours</th><td>{{ checkOpenStatus(detail?.opening_hours) }}
            <button type="button" class="btn btn-link" data-toggle="modal" data-target="#open_hour">
              Open Hour
            </button>
          </td></tr>
        </tbody>
      </table>
    </div>

    <!--photo-->
    <div class="tab-pane fade mt-3 row" id="photos">
      <div class="alert alert-warning" role="alert" *ngIf="!photos || photos.length === 0" >
        No records.
      </div>
      <div class="container-fluid row">
        <div *ngFor="let col of photo_col" class="col-md-3" style="padding: 0">
          <div *ngFor="let photo of col" class="mt-2 mr-2">
            <a href="{{ photo }}" target="_blank"><img src="{{photo}}" alt="" style="width: 100%"></a>
          </div>
        </div>
      </div>
    </div>

    <!--map-container-->
    <div class="tab-pane fade mt-3 container" id="map_container">
      <form class="row" [formGroup]="form" (submit)="calcRoute($event)">
        <div class="form-group col-md-3">
          <label for="start_loc_route">From</label>
          <input class="form-control" formControlName="start_loc_route" type="text" id="start_loc_route">
        </div>

        <div class="form-group col-md-3">
          <label for="end_route">To</label>
          <input class="form-control" formControlName="end_route" type="text" id="end_route" disabled value="{{ detail?.formatted_address }}">
        </div>

        <div class="form-group col-md-3">
          <label for="travel_mode">Travel Mode</label>
          <select id="travel_mode" class="form-control customer-select" formControlName="travel_mode" >
            <option *ngFor="let mode of travel_modes" [value]="mode">
              {{ capitalize(mode) }}
            </option>
          </select>
        </div>

        <div class="form-group col-md-3 align-bottom">
          <!--<label for="search">&nbsp;</label>-->
          <button class="btn btn-primary" type="submit" name="search" id="search"
                  style="position: absolute; bottom: 0;"
                  [ngClass]="{
                    'is-invalid': form.controls.start_loc_route.errors && form.controls.start_loc_route.dirty,
                    'is-valid': !form.controls.start_loc_route.errors}"
                  [disabled]="!form.valid">Get Direction</button>
        </div>

      </form>

      <div style="width: 40px; height: 40px;" class="mb-2 clickable" (click)="toggleMapContent()">
        <img *ngIf="showMap" src="http://cs-server.usc.edu:45678/hw/hw8/images/Map.png" style="width: 100%; height: 100%" alt="">
        <img *ngIf="!showMap" src="http://cs-server.usc.edu:45678/hw/hw8/images/Pegman.png" style="width: 100%; height: 100%" alt="" >
      </div>

      <div id="map" [ngClass]="{'show_map_content': showMap, 'hide_map_content': !showMap}"></div>
      <div id="streetView" [ngClass]="{'show_map_content': !showMap, 'hide_map_content': showMap}"></div>

      <!--show detail routes-->
      <div id="detail_routes"></div>
    </div>

    <!--reviews-->
    <div class="tab-pane fade mt-3" id="reviews">
        <div class="dropdown d-inline-block">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            {{ review_origin }}
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton1">
            <a class="dropdown-item" href="#" (click)="changeReviewOrigin(true)">Google Reviews</a>
            <a class="dropdown-item" href="#" (click)="changeReviewOrigin(false)">Yelp Reviews</a>
          </div>
        </div>

        <div class="dropdown d-inline-block">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            {{ order_method }}
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton2">
            <a class="dropdown-item" href="#" (click)="reviews_order(0)">Default	Order</a>
            <a class="dropdown-item" href="#" (click)="reviews_order(1)">Highest Rating</a>
            <a class="dropdown-item" href="#" (click)="reviews_order(2)">Lowest	Rating</a>
            <a class="dropdown-item" href="#" (click)="reviews_order(3)">Most Recent</a>
            <a class="dropdown-item" href="#" (click)="reviews_order(4)">Least	Recent</a>
          </div>
        </div>

      <div class="alert alert-warning" role="alert"
           *ngIf="(review_origin === 'Google Reviews' && (!google_reviews || google_reviews.length === 0)) ||
           (review_origin === 'Yelp Reviews' && (!yelp_reviews || yelp_reviews.length === 0))" >
        No records.
      </div>

      <!--Google reviews-->
      <div class="container" *ngIf="review_origin === 'Google Reviews' && google_reviews" >
        <div class="card mt-2" *ngFor="let review of google_reviews">
          <div class="card-body row">
            <div class="col-md-2">
              <img src="{{ review['profile_photo_url']}}" style="max-width: 50px;">
            </div>
            <div class="col-md-10">
              <div><a href="{{ review['author_url'] }}" target="_blank">{{ review['author_name']}}</a></div>
              <div>
                <span><i *ngFor="let n of createArr(review['rating'])" class="fas fa-star" style="color: gold"></i></span>
                <span> {{ formatDate(review['time']) }}</span>
              </div>
              <div>{{ review['text'] }}</div>
            </div>
          </div>
        </div>
      </div>
      <!--Yelp reviews-->
      <div class="container" *ngIf="review_origin === 'Yelp Reviews' && yelp_reviews">
        <div class="card mt-2" *ngFor="let review of yelp_reviews">
          <div class="card-body row">
            <div class="col-md-2">
              <img src="{{ review?.user['image_url'] }}" style="max-width: 50px;">
            </div>
            <div class="col-md-10">
              <div><a href="{{ review?.url }}" target="_blank">{{ review?.user['name']}}</a></div>
              <div><span><i *ngFor="let n of createArr(review?.rating)" class="fas fa-star" style="color: gold"></i></span><span> {{ review?.time_created }}</span> </div>
              <div>{{ review?.text }}</div>
            </div>
          </div>
        </div>
      </div>

    </div> <!-- Reviews -->
  </div>

  <!-- Modal -->
  <div class="modal fade" id="open_hour" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Open Hour</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <table class="table">
            <tbody>
            <tr *ngFor="let text of opening_hours['weekday_text']; let i = index "
                [ngClass]="{'font-weight-bold': checkWeekday(i)}">
              <td>{{ text.split(":")[0] }}</td>
              <td>{{ formatOpenTime(text) }}</td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

</div>


